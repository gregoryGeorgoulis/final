<script type="text/javascript">

$(document).ready(function() {

	var daJax = function(){
		var numData = [];
		var numData2 = [];
		var numData3 = [];
		var numData4 = [];
		var nameData = [];
		var nameData2 = [];
		var nameData3 = [];
		var nameData4 = [];
		$.ajax({
			url: "/states/polster",
			method: "GET",
			dataType: 'json',
			success: function(data) {
				$("#container").empty();
				//heading
				// console.log(data[7].questions[0]);
				// //for registered voters
				// console.log(data[7].questions[0].subpopulations[0].name);
				data[8].questions[0].subpopulations[0].responses.forEach(function(data) {
					nameData.push(data.choice);
				});
				data[8].questions[0].subpopulations[0].responses.forEach(function(data) {
					numData.push(data.value)
				});
				label1 = data[8].questions[0].subpopulations[0].name
				// console.log(label1);
				createGraph(numData, label1, nameData);
				// //for democrates
			 // console.log(data[0].questions[0].subpopulations[1]);
			 data[8].questions[0].subpopulations[1].responses.forEach(function(data) {
					nameData2.push(data.choice);
				});
			 data[8].questions[0].subpopulations[1].responses.forEach(function(data) {
					numData2.push(data.value)
				});
			 label2 = data[8].questions[0].subpopulations[1].name
			 createGraph(numData2, label2, nameData2);
				// //for republicans
				// console.log(data[0].questions[0].subpopulations[2]);
				data[8].questions[0].subpopulations[2].responses.forEach(function(data) {
					nameData3.push(data.choice);
				});
				data[8].questions[0].subpopulations[2].responses.forEach(function(data) {
					numData3.push(data.value)
				});
				label3 = data[8].questions[0].subpopulations[2].name
				createGraph(numData3, label3, nameData3)
				// //for independent
				 // console.log(data[0].questions[0].subpopulations[3]);
				 data[8].questions[0].subpopulations[3].responses.forEach(function(data) {
					nameData4.push(data.choice);
				});
				data[8].questions[0].subpopulations[3].responses.forEach(function(data) {
					numData4.push(data.value)
				});
				label4 = data[8].questions[0].subpopulations[3].name
				createGraph(numData4, label4, nameData4)
			}				
		})
	};
	

	
	var createGraph = function(theData, label, name) {
		var margin = {top: 20, right: 10, bottom: 20, left: 10};
		var width = 450;
		var height = 200;

		var widthScale = 
			d3.scaleLinear()
				.domain([0, 100])
				.range([0, width]);

		var color = 
			d3.scaleLinear()
			.domain([0, 100])
			.range(["red", "blue"]);

		var axis = 
			d3.axisBottom()
				.scale(widthScale);

		var canvas = 
		d3.select("#container")
			.append("div")
			.attr("class","graph")
			.append("svg")
			.attr("width", width)
			.attr("height", height)
			.append("g")
			.attr("transform", "translate(20, 50)");

		canvas.selectAll("text")
		.data(theData)
		.enter()
		.append("text")
    .text(function(d) {return d;})	
    .attr("x",function(d) {return widthScale(d);})
    .attr("y",function(d, i) {return (i * 30) + 15 ;});

    canvas.selectAll("g")
		.data(name)
		.enter()
    .append("text")
    .text(function(d) {return d;})
    .data(theData)	
    .attr("x",function(d) {return widthScale(d) + 20;})
    .attr("y",function(d, i) {return (i * 30) + 15 ;});

		var bars = 
		canvas.selectAll("rect")
			.data(theData)
			.enter()
				.append("rect")
				.attr("width", function(d) {return 0 })
				.attr("height", 20)
				.attr("fill", function(d) {return color(d) })
				.attr("y", function(d, i) { return i * 30 })


		bars.transition()
			.duration(2000)
			.attr("width",function(d) {return widthScale(d)})

		canvas.append("text")
			.attr("x", (width / 2))             
      .attr("y", 0 - (margin.top / 2))
      .attr("text-anchor", "middle")  
      .style("font-size", "16px") 
      .style("text-decoration", "underline")  
      .text(label);

		canvas.append("g")
			.attr("transform", "translate(0, 100)")
			.call(axis);
	}

	daJax();

})

</script>





































